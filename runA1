cd test-network
./network.sh down
./network.sh up createChannel -ca

cd addOrg3
./addOrg3.sh up -ca

cd ../
./network.sh deployCC -ccn auction -ccp ../auction1/chaincode-go/ -ccl go

cd ../auction1/application-javascript

node enrollAdmin.js org1
node enrollAdmin.js org2
node enrollAdmin.js org3

node registerEnrollUser.js org1 seller

node registerEnrollUser.js org1 bidder1
node registerEnrollUser.js org2 bidder2
node registerEnrollUser.js org3 bidder3

node createAuction.js org1 seller Auction1 Item1

OUTPUT=$(node bid.js org1 bidder1 Auction1 500)
echo $OUTPUT
# Get line contaiining SAVE THIS VALUE
SAVE_THIS_VALUE=$(echo "$OUTPUT" | grep "SAVE THIS VALUE")
# Get the value after : and trim whitespace
bidId1=$(echo "$SAVE_THIS_VALUE" | cut -d':' -f2 | xargs)
echo $bidId1
node submitBid.js org1 bidder1 Auction1 $bidId1

# Second Bidder: 800 price
OUTPUT=$(node bid.js org2 bidder2 Auction1 800)
echo $OUTPUT
# Get line contaiining SAVE THIS VALUE
SAVE_THIS_VALUE=$(echo "$OUTPUT" | grep "SAVE THIS VALUE")
# Get the value after : and trim whitespace
bidId2=$(echo "$SAVE_THIS_VALUE" | cut -d':' -f2 | xargs)
node submitBid.js org2 bidder2 Auction1 $bidId2

# Third Bidder: 700 price
OUTPUT=$(node bid.js org3 bidder3 Auction1 700)
echo $OUTPUT
# Get line contaiining SAVE THIS VALUE
SAVE_THIS_VALUE=$(echo "$OUTPUT" | grep "SAVE THIS VALUE")
# Get the value after : and trim whitespace
bidId3=$(echo "$SAVE_THIS_VALUE" | cut -d':' -f2 | xargs)
node submitBid.js org3 bidder3 Auction1 $bidId3

# Close Auction
node closeAuction.js org1 seller Auction1

# Revealing Stage
node revealBid.js org1 bidder1 Auction1 $bidId1
node revealBid.js org2 bidder2 Auction1 $bidId2
node revealBid.js org3 bidder3 Auction1 $bidId3

# Declare Winner
OUTPUT=$(node endAuction.js org1 seller Auction1)
echo $OUTPUT
# Get line containing "winner":
WINNER=$(echo "$OUTPUT" | grep "winner\"")

# cut at first = till , 
winner=$(echo "$WINNER" | cut -d'=' -f2 | cut -d',' -f1 | xargs)

# Cut at second = till + 
org=$(echo "$WINNER" | cut -d'=' -f3 | cut -d'+' -f1 | xargs)

echo $winner $org

# Clean Up
rm -rf wallet
cd ../../test-network/
./network.sh down

# check if winner and org are empty
if [ -z "$winner" ] && [ -z "$org" ]
then
    # Print auction failed in red
    echo -e "\e[31mAuction Failed\e[0m" 
    exit 1
fi

# Print in green color winner and org
echo -e "\e[32mWinner is $winner from $org\e[0m"
